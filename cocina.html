<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pedidos en Cocina - Cocina de la G√ºera</title>
  <link rel="stylesheet" href="style.css">

  <!-- Firebase versi√≥n de compatibilidad -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <!-- Tu script personalizado -->
  <script src="script.js" defer></script>
</head>

<body>
<h1>Pedidos en Cocina</h1>

<div id="listaPedidos"></div>

<!-- Bot√≥n flotante para volver al men√∫ -->
<div class="boton-flotante">
  <button onclick="window.location.href='menu.html'">üè† Men√∫ Principal</button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Verificar que haya sesi√≥n iniciada
    if (localStorage.getItem('logueado') !== 'true') {
      window.location.href = 'login.html';
    }

    iniciarFirebase(); // Conectar Firebase
    const listaPedidos = document.getElementById('listaPedidos');
    const db = firebase.firestore();

    db.collection("pedidos").orderBy("timestamp").onSnapshot((querySnapshot) => {
      listaPedidos.innerHTML = "";

      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const div = document.createElement('div');
        div.classList.add('pedido');

        div.innerHTML = `
          <p><strong>Mesa:</strong> ${data.mesa}</p>
          <p><strong>Pedido:</strong> ${data.pedido}</p>
          <input type="number" id="precio-${doc.id}" placeholder="Precio final ($)" required><br><br>
          <button onclick="terminarPedido('${doc.id}', '${data.mesa}', \`${data.pedido}\`)">‚úÖ Pedido Listo</button>
          <hr>
        `;
        listaPedidos.appendChild(div);
      });
    });
  });

  // Funci√≥n para terminar pedido, moverlo a "pedidos_terminados" y eliminarlo de "pedidos"
  async function terminarPedido(id, mesa, pedido) {
    const precioInput = document.getElementById(`precio-${id}`);
    const precio = parseFloat(precioInput.value);

    if (isNaN(precio) || precio <= 0) {
      alert('Por favor ingresa un precio v√°lido.');
      return;
    }

    const db = firebase.firestore();

    await db.collection('pedidos_terminados').add({
      mesa,
      pedido,
      precio,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    await db.collection('pedidos').doc(id).delete();

    alert('Pedido terminado ‚úÖ');
  }
</script>

</body>
</html>