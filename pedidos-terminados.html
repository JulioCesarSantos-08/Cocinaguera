<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ventas del DÃ­a - Cocina de la GÃ¼era</title>
  <link rel="stylesheet" href="style.css">

  <!-- Firebase versiÃ³n de compatibilidad -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <!-- Tu script personalizado -->
  <script src="script.js" defer></script>
</head>

<body>
<h1>Ventas del DÃ­a</h1>

<div id="listaVentas"></div>

<h2 id="totalVenta">Total: $0</h2>

<!-- BotÃ³n para eliminar todas las ventas -->
<button onclick="eliminarTodasLasVentas()" class="eliminar-todo">ğŸ—‘ï¸ Eliminar Todo</button>

<!-- BotÃ³n flotante para regresar al menÃº -->
<div class="boton-flotante">
  <button onclick="window.location.href='menu.html'">ğŸ  MenÃº Principal</button>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Verificar sesiÃ³n iniciada
    if (localStorage.getItem('logueado') !== 'true') {
      window.location.href = 'login.html';
    }

    iniciarFirebase();
    const listaVentas = document.getElementById('listaVentas');
    const totalVenta = document.getElementById('totalVenta');
    const db = firebase.firestore();

    db.collection("pedidos_terminados").orderBy("timestamp").onSnapshot((querySnapshot) => {
      listaVentas.innerHTML = "";
      let total = 0;

      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const div = document.createElement('div');
        div.classList.add('venta');

        div.innerHTML = `
          <p><strong>Mesa:</strong> ${data.mesa}</p>
          <p><strong>Pedido:</strong> ${data.pedido}</p>
          <p><strong>Precio:</strong> $${data.precio.toFixed(2)}</p>
          <hr>
        `;
        listaVentas.appendChild(div);

        total += data.precio;
      });

      totalVenta.textContent = `Total: $${total.toFixed(2)}`;
    });
  });

  // FunciÃ³n para eliminar todas las ventas
  async function eliminarTodasLasVentas() {
    if (!confirm('Â¿EstÃ¡s seguro que deseas eliminar todas las ventas? âŒ')) return;

    const db = firebase.firestore();
    const snapshot = await db.collection('pedidos_terminados').get();

    const batch = db.batch();

    snapshot.forEach((doc) => {
      batch.delete(doc.ref);
    });

    await batch.commit();
    alert('Todas las ventas fueron eliminadas.');
  }
</script>

</body>
</html>